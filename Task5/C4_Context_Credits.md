# C4 Context Diagram: Онлайн подача заявок на кредит

## Описание

Эта диаграмма расширяет контекст из Task 3, добавляя потоки кредитных заявок.

---

## Дополнительные/Изменённые элементы

### Системы:

#### **Система онлайн кредитования** [Software System] (НОВАЯ)
- **Описание:** Новая система для подачи и обработки заявок на кредиты онлайн
- **Технологии:** Java Spring Boot, PostgreSQL, Kafka
- **Ответственность:**
  - Управление кредитными заявками
  - Интеграция с системой скоринга
  - Предодобренные кредитные предложения
  - Интеграция между каналами и Кредитным конвейером
- **Цвет на диаграмме:** Синий (система в фокусе)

#### **Система скоринга** [Software System] (ОБНОВЛЕНИЕ)
- **Описание:** Система кредитного скоринга (уже существует, см. Task 1)
- **Технологии:** Python, Flask, PostgreSQL
- **Ответственность:**
  - Расчёт кредитного скоринга
  - Batch-процесс предрасчёта предодобренных предложений (ежедневно, ночью)
  - Instant scoring для новых клиентов (через БКИ)
- **Новые связи:**
  - ← Система онлайн кредитования: "Запрашивает скоринг и предодобренные предложения"
  - → БКИ: "Запрашивает кредитную историю для новых клиентов"
- **Цвет:** Серый (существующая система)

#### **Кредитный конвейер** [Software System] (ОБНОВЛЕНИЕ)
- **Описание:** Система обработки кредитных заявок (существует, см. Task 1)
- **Технологии:** Camunda BPM, Oracle, Java
- **Ответственность:**
  - Обработка кредитных заявок сотрудниками бэк-офиса
  - Workflow кредитования
  - Приоритизация заявок (предодобренные vs обычные)
- **Новые связи:**
  - ← Система онлайн кредитования (Kafka): "Получает заявки в реальном времени"
  - → Система онлайн кредитования (Kafka): "Отправляет статусы заявок"
  - → АБС: "Зачисление средств при одобрении"
- **Цвет:** Серый

#### **БКИ (Бюро кредитных историй)** [External System] (уже есть в Task 1)
- **Описание:** Внешняя система для получения кредитных историй
- **Ответственность:** Предоставление данных о кредитной истории клиентов
- **Связи:**
  - ← Система скоринга: "Запросы кредитной истории через REST API"
- **Цвет:** Светло-серый (внешняя система)

---

## Обновлённые связи существующих систем

#### **Интернет-банк** (обновление)
**Новые связи:**
- → Система онлайн кредитования (HTTP API): "Получает предодобренные предложения, подаёт заявки на кредит, получает статусы"

#### **Сайт** (обновление)
**Новые связи:**
- → Система онлайн кредитования (HTTP API): "Подаёт заявки на кредит от новых клиентов, получает мгновенное решение"

#### **АБС** (обновление)
**Новые связи:**
- ← Кредитный конвейер: "Зачисление кредитных средств на счета клиентов"
- → Система скоринга: "Передача данных клиентов раз в сутки (для batch-процесса)"

---

## Потоки данных

### Поток 1: Предодобренное предложение (интернет-банк)
```
Система скоринга (batch-процесс, ночью)
  → АБС: "Получает данные клиентов"
  → БКИ: "Получает кредитные истории (кэшированные)"
  → Предрасчёт скоринга для всех клиентов
  → Сохранение предодобренных предложений

Клиент банка
  → Интернет-банк: "Открывает раздел Кредиты"
  → Система онлайн кредитования: "Запрашивает предодобренные предложения"
  → Система скоринга: "Возвращает предложение"
  → Интернет-банк: "Отображает предодобренное предложение"
  → Клиент видит предложение
```

### Поток 2: Подача заявки по предодобренному предложению (интернет-банк)
```
Клиент банка
  → Интернет-банк: "Подаёт заявку на кредит"
  → Система онлайн кредитования: "Создаёт заявку"
  → Kafka: "Публикует заявку (pre_approved: true)"
  → Кредитный конвейер: "Получает заявку (высокий приоритет)"
  → Сотрудник бэк-офиса кредитов: "Обрабатывает заявку"
  → Кредитный конвейер → Система скоринга: "Подтверждение скоринга"
  → Сотрудник одобряет
  → Кредитный конвейер → АБС: "Зачисление средств"
  → АБС → СМС-шлюз → Клиент: "СМС о зачислении"
```

### Поток 3: Новый клиент с сайта (мгновенное решение)
```
Новый клиент
  → Сайт: "Заполняет форму с паспортными данными"
  → Система онлайн кредитования: "Подаёт заявку"
  → Система скоринга: "Instant scoring"
  → БКИ: "Запрашивает кредитную историю"
  → Система скоринга: "Рассчитывает скоринг"
  → Система онлайн кредитования: "Получает результат"
  → Сайт: "Отображает мгновенное решение (одобрено/не одобрено)"
  → СМС клиенту с адресом отделения
```

---

## Ключевые акторы

### Существующие (из Task 3):
- Клиент банка (авторизованный)
- Новый клиент
- Сотрудник бэк-офиса кредитов (уже есть в Task 1)
- Сотрудник отделения

### Взаимодействие с новыми системами:
- **Клиент банка:**
  - Просматривает предодобренные кредитные предложения (интернет-банк)
  - Подаёт заявки на кредит (интернет-банк)
  - Отслеживает статусы заявок (интернет-банк)

- **Новый клиент:**
  - Подаёт заявку на кредит на сайте
  - Получает мгновенное решение (если указаны паспортные данные)
  - Приходит в отделение для получения кредита

- **Сотрудник бэк-офиса кредитов:**
  - Обрабатывает заявки в Кредитном конвейере
  - Видит приоритет заявок (предодобренные vs обычные)
  - Проверяет результаты скоринга
  - Одобряет/отклоняет заявки

- **Сотрудник отделения:**
  - Ищет заявки новых клиентов в АБС
  - Идентифицирует новых клиентов (паспорт)
  - Открывает счета и выдаёт кредиты

---

## Инструкция для визуализации в draw.io:

1. Взять диаграмму контекста из Task 3
2. Добавить справа "Система онлайн кредитования" (синий прямоугольник)
3. Добавить "Система скоринга" (если ещё нет) - серый
4. Добавить "Кредитный конвейер" - серый
5. Добавить "БКИ" - светло-серый (внешняя)
6. Соединить стрелками:
   - Интернет-банк ↔ Система онлайн кредитования (API)
   - Сайт → Система онлайн кредитования (API)
   - Система онлайн кредитования ↔ Система скоринга (API)
   - Система скоринга ↔ БКИ (REST API)
   - Система онлайн кредитования ↔ Кредитный конвейер (Kafka)
   - Кредитный конвейер → АБС (зачисление средств)
   - АБС → Система скоринга (данные клиентов, раз в сутки)
7. Группировка:
   - Сгруппировать системы банка в контейнер "Банк Стандарт"
   - Выделить внешнюю систему БКИ за границей
8. Добавить легенду с цветовым кодированием
9. Опционально: выделить новые потоки другим цветом стрелок
